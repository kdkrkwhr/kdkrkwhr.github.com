---
layout: post
author: Kim, DongKi
title:  "Spring Boot MSA ì ìš©ê¸° (With. Netflex Eureka)"
date:   2021-12-29
categories: Technology
comments: true
---

### TL;DR

ì •ë§ ì˜¤ëœë§Œì— ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì„í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ê·¸ë™ì•ˆ ì´ê²ƒì €ê²ƒ ì •ë¦¬ëŠ” í–ˆì§€ë§Œ .. ë¸”ë¡œê·¸ë¡œ ì˜®ê¸°ë ¤ë‹ˆ ê·€ì°®ì•„ì§€ë”ë¼êµ¬ìš” .. ğŸ˜¢

ê³§ 2022ë…„ì´ ë‹¤ê°€ì˜¤ë‹ˆ ë‹¤ì‹œ ì´ˆì‹¬ì„ ì°¿ê³  ì—´ì‹¬íˆ í¬ìŠ¤íŒ…ì„ í•´ ë³¼ ìƒê°ì…ë‹ˆë‹¤. 

í™”ì´íŒ…~ ğŸ‘Š

* ( ëª©í‘œ :: ì£¼ 1íšŒ í¬ìŠ¤íŒ…í•˜ê¸° .. ğŸ˜¤ )


----
### MSA ë€?

* ì„œë¹„ìŠ¤ì— ë„ì¶œë˜ëŠ” ë„ë©”ì¸ë“¤ì„ ì»´í¬ë„ŒíŠ¸ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ì„¤ê³„í•˜ëŠ” êµ¬ì¡° ê¸°ë²•.

* DDD(ë„ë©”ì¸ ì£¼ë„ ê°œë°œ)ì‹œ MSAë¥¼ ê³ë“¤ì—¬ ì‚¬ìš©í•˜ë©´ ì‹œë„ˆì§€ê°€ ì¢‹ë‹¤.

* ì¥ì ë„ ë§ìœ¼ë‚˜, ë‹¨ì ë„ ëª…í™•íˆ ì¡´ì¬í•˜ê¸°ì— ì‚¬ìš© ì „ MSAë¥¼ ì ìš©í•˜ëŠ”ê²Œ ë§ëŠ”ì§€ ê³ ë¯¼ì´ í•„ìš”í•˜ë‹¤. (êµ³ì´ ì‹ ê¸°ìˆ ì´ë¼ê³  ì¢‹ì•„ë¼ ì ìš©í•œë‹¤ë©´ ë‚˜ì¤‘ì— í›„íšŒ í• ì§€ë„ ..)

* ì¥ì 
  * ê° ì»´í¬ë„ŒíŠ¸ë³„ë¡œ ë‚˜ëˆ ì ¸ ìˆê¸°ì—, ê° ì»´í¬ë„ŒíŠ¸ë¥¼ ìˆ˜ì •/ì¶”ê°€ ì‘ì—… ì´í›„ ì†Œìš”ë˜ëŠ” í…ŒìŠ¤íŠ¸ ë° ë¹Œë“œì‹œê°„ì´ ë‹¨ì¶• ë¨.
  * ì—¬ëŸ¬ ì–¸ì–´ ë° ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±í•  ìˆ˜ ìˆê¸°ì— ìµœì ì˜ ê¸°ìˆ ì„ íƒ‘ì¬í•˜ê¸° ìš©ì´
  * ì„œë²„ ë˜ëŠ” ì‹ ê·œ ì„œë¹„ìŠ¤ ì»´í¬ë„ŒíŠ¸ í™•ì¥ ì‹œ ìš©ì´ í•¨

* ë‹¨ì 
  * ì´ˆê¸° ì„¸íŒ…/êµ¬ì¡° ì„¤ê³„ ì‹œ ë§ì€ ë¹„ìš©ì´ ë°œìƒ.
  * ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ / ì„œë²„ê°€ ìƒê¸°ê¸°ì— ê·¸ì— ë”°ë¥¸ ê´€ë¦¬í¬ì¸íŠ¸ê°€ ì¦ê°€. 
  * DB ê°™ì€ Connection Pool ë“± ë˜í•œ ê°ê°ì˜ ì»´í¬ë„ŒíŠ¸ê°€ ë”°ë¡œ ê°€ì§€ê³  ìˆê¸°ì— Transactionë“±ì„ ì¼ê´€ì„±ìˆê²Œ ìœ ì§€í•˜ê¸° ì–´ë µë‹¤.


![2021-12-29-msa-start-2.jpg](/assets/2021-12-29-msa-start-2.jpg)


----
#### Netflex Eureka 

* Neflixì—ì„œ ê³µê°œí•œ MSA í´ë¼ìš°ë“œ ì˜¤í”ˆì†ŒìŠ¤.

* í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬/ê´€ë¦¬ í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆê¸°ì—, ì´ë¥¼ ë„ì™€ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸ì¤‘ í•˜ë‚˜ê°€ Netflex OSS ì¸ Eureka ì´ë‹¤.  

* DiscoveryëŠ” Eureka ë‚´ ì¡´ì¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì— ì—°ê²° ì •ë³´ë¥¼ ì°¿ëŠ”ê²ƒì„ ì˜ë¯¸ í•˜ê³ , RegistryëŠ” ê° ì»´í¬ë„ŒíŠ¸ê°€ ì—°ê²° ì •ë³´ë¥¼ Eurekaì— ë“±ë¡í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

* í¬ê²Œ Eureka Serverì™€ Eureka Clientë¡œ ë‚˜ë‰˜ë©°, Server ì—ì„œëŠ” ê° Eureka Client ì»´í¬ë„ŒíŠ¸ë“¤ì— ì—°ê²° ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê³ , Clientì—ì„œëŠ” ì´ëŸ¬í•œ ì—°ê²° ì •ë³´ë¥¼ Serverì— ì•Œë ¤ì£¼ë©°, Disdcovery Serverì— ê´€ë¦¬ì¤‘ì¸ ì—°ê²°ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Routing ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤. ì´í›„ Routing ëœ Clientë“¤ì€ ê° ì»´í¬ë„ŒíŠ¸ ë‚´ ì‘ì„±í•œ ì„œë¹„ìŠ¤ëŒ€ë¡œ ì²˜ë¦¬ê°€ ëœë‹¤.

* Zuul, Ribbon, hystrix ë“±ì„ ì´ìš©í•œ ë‹¤ì–‘í•œ MSA ì§€ì› ì„œë¹„ìŠ¤ë¥¼ ì œê³µ


----
### Spring Boot ë‚´ ì ìš©

![2021-12-29-msa-start-3.jpg](/assets/2021-12-29-msa-start-3.jpg)

* ê° ì»´í¬ë„ŒíŠ¸ì— ì—°ê²° ì •ë³´ë¥¼ ê´€ë¦¬ í•  Discovery Server ì»´í¬ë„ŒíŠ¸
* Routingì„ ê´€ë¦¬í•  Zuul ì»´í¬ë„ŒíŠ¸
* ì‹¤ì œ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•  ë‹¤ìˆ˜ì˜ ì„œë¹„ìŠ¤ ì»´í¬ë„ŒíŠ¸ 


---
#### Discovery Server (Server)

[Build]

```gradle
dependencies {
    ```
	implementation group: 'org.springframework.cloud', name: 'spring-cloud-starter-netflix-eureka-server', version: '2.2.9.RELEASE'
    ```
}
```

[properties]

```properties
server: 
  port: 8081
spring: 
  application:
    name: kdk-eureka-server
```

[ServerApplication]

```java
@EnableEurekaServer
@SpringBootApplication
public class DefaultServerApplication {

  public static void main(String[] args) {
    SpringApplication.run(DefaultServerApplication.class, args);
  }
}
```


* ë¨¼ì € Discovery Server êµ¬ì„±ì„ ìœ„í•œ Libë¥¼ ë¹Œë“œ í•´ì£¼ê³ , properties ì„¤ì •ì„ ì§„í–‰ í•´ì¤€ë‹¤

* ì–´í”Œë¦¬ì¼€ì´ì…˜ íŒŒì¼ ë‚´ @EnableEurekaServer Annotationì„ ì¶”ê°€í•˜ì—¬ Eureka Serverì„ì„ ì„ ì–¸ í•´ì£¼ë©´ Discovery ì„œë²„ëŠ” ì„¸íŒ…ì´ ì™„ë£Œ ëœë‹¤.


![2021-12-29-msa-start-4.jpg](/assets/2021-12-29-msa-start-4.jpg)


---
#### Zuul Component (Client)

[Build]

```gradle
dependencies {
    ```
	implementation group: 'org.springframework.cloud', name: 'spring-cloud-starter-netflix-eureka-client', version: '2.2.9.RELEASE'
	implementation group: 'org.springframework.cloud', name: 'spring-cloud-starter-netflix-zuul', version: '2.2.9.RELEASE'
    ```
}
```

[properties]

```properties
server: 
  port: 8100
spring: 
  application:
    name: kdk-eureka-zuul
zuul:
  routes:
    service-1:
      stripPrefix: false
      path: /api/**
      url: http://localhost:8101
    service-2:
      stripPrefix: false
      path: /craw/**
      url: http://localhost:8102
eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    serviceUrl:
      defaultZone: http://localhost:8081/eureka/
```

* propoerties
  * name
    * Application Name
  * zuul.routes
    * zuulì„ í†µí•´ routing ë  Service Application ì§€ì •
  * zuul.strinpPrefix
    * prefixë¥¼ ì‚¬ìš©í• ì§€ ì—¬ë¶€ 
      * (í˜„ì¬ ì§€ì •í•œ zuul prefixê°€ ì—†ëŠ” ê´€ê³„ë¡œ false setting)
  * zuul.path
    * router Path ì§€ì • 
      * (Zuulì„ í†µí•´ â€œ /api/** â€œë¡œ ì ‘ê·¼í•˜ëŠ” í˜¸ì¶œì€ ëª¨ë‘ ìœ„ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©)
  * eureka.client.register-with-eureka
    * Eureka ì„œë²„ ë‚´ ë“±ë¡ ì—¬ë¶€
  * eureka.client.fetch-registry
    * ë“±ë¡ ëœ ì„œë¹„ìŠ¤ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ì§€ ì—¬ë¶€
  * eureka.client.serviceUrl.defaultZone
    * Eureka Discovery Server Url (Default)


[ServerApplication]

```java
@SpringBootApplication
@EnableZuulProxy
@EnableDiscoveryClient
public class DefaultServerApplication {

  public static void main(String[] args) {
    SpringApplication.run(DefaultServerApplication.class, args);
  }
}
```


* Eureka Client Lib ì™€ Routingì„ ì§€ì›í•  Zuul Lib ë¥¼ ë¹Œë“œ
* propertes íŒŒì¼ ë‚´ zuulì„ ì´ìš©í•œ Routing ë°©ì‹ì„ ì§€ì •
* ì–´í”Œë¦¬ì¼€ì´ì…˜ íŒŒì¼ ë‚´ @EnableZuulProxy Annotationì„ ì¶”ê°€í•˜ì—¬ Routing Application ì„ì„ ë¶€ì—¬
* ì–´í”Œë¦¬ì¼€ì´ì…˜ íŒŒì¼ ë‚´ @EnableDiscoveryClient Annotationì„ ì¶”ê°€í•˜ì—¬ Eureka Client ì„ì„ ë¶€ì—¬

![2021-12-29-msa-start-5.jpg](/assets/2021-12-29-msa-start-5.jpg)


---
#### Service Component (Client)

[build]

```gradle
dependencies {
    ```
    implementation group: 'org.springframework.cloud', name: 'spring-cloud-starter-netflix-eureka-client', version: '2.2.9.RELEASE'
    ```
}
```

[properties]

```properties
server: 
  port: 8101
spring: 
  application:
    name: kdk-eureka-zuul-service
eureka:
  client:
    fetch-registry: true
    serviceUrl:
      defaultZone: http://localhost:8081/eureka/
```

[ServerApplication]

```java
@EnableDiscoveryClient
@SpringBootApplication
public class DefaultServerApplication {

  public static void main(String[] args) {
    SpringApplication.run(DefaultServerApplication.class, args);
  }
}
```

[Controller]

```java
@RestController
@RequestMapping(value = "/api", produces = MediaType.APPLICATION_JSON_VALUE)
public class TestRestCOntroller {

  @RequestMapping(value = "/{value}", method = RequestMethod.GET)
  public String eurekaClient(@PathVariable("value") String value) {
    return value == null ? "NA" : value;
  }
}
```


* ì•ì„œ Zuul ì»´í¬ë„ŒíŠ¸ì—ì„œ í–‰í–ˆë˜ ì ˆì°¨ì™€ ë™ì¼í•˜ê²Œ, Clientë¥¼ ë¹Œë“œ í•˜ê³  ì–´í”Œë¦¬ì¼€ì´ì…˜ ëª…ëª…ì„ ì§€ì •í•´ì£¼ë©´ ì„¸íŒ… ì™„ë£Œ
* ì´í›„ Zuulì—ì„œ ì„ ì–¸í–ˆë˜ ë°”ì™€ ê°™ì´ í˜„ì¬ ì„œë¹„ìŠ¤ ì»´í¬ë„ŒíŠ¸ ê²½ìš° path '/api/**'ë¥¼ ê°€ì ¸ê°€ê¸°ì— í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ ë‚´ ëª¨ë“  API Urlì€ ë™ì¼ prefix ê°’ ì„ ê°€ì ¸ê°„ë‹¤

![2021-12-29-msa-start-6.jpg](/assets/2021-12-29-msa-start-6.jpg)


---
### í…ŒìŠ¤íŠ¸ .. 

* ìœ„ ë‹¨ê³„ê¹Œì§€ ì§„í–‰í•˜ì˜€ë‹¤ë©´ ê°„ë‹¨í•œ MSA êµ¬ì„± ì„¸íŒ…ì€ ì™„ë£Œ.
* í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ Zuul Rounting ì»´í¬ë„ŒíŠ¸(port :: 8101) ë¡œ í…ŒìŠ¤íŠ¸ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì˜ ë˜ëŠ”ì§€ í™•ì¸.

![2021-12-29-msa-start-7.jpg](/assets/2021-12-29-msa-start-7.jpg)

* ì„±ê³µì ìœ¼ë¡œ Routingì´ ë˜ì–´ ì›í•˜ë˜ ê²°ê³¼ê°€ ë‚˜ì˜¨ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


---
### ë§ˆë¬´ë¦¬

* ìœ„ í¬ìŠ¤íŒ…ìœ¼ë¡œ Netflex Eurekaë¥¼ ì´ìš©í•œ Spring Boot ê¸°ë°˜ NSA êµ¬ì¡°ë¥¼ êµ¬ì„±í•´ë³´ì•˜ìŠµë‹ˆë‹¤!ğŸ˜„
* ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ëŠ” Pythonì—ì„œë„ Eurekaë¥¼ ì ìš©í•˜ì—¬ í…ŒìŠ¤íŒ… í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œ í•´ë³¼ê¹Œ í•©ë‹ˆë‹¤!


ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ :)

Thanks .
